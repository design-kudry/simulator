<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Design Simulator</title>
<link rel="icon" type="image/png" href="assets/favicon.png">

<!-- Network priority hints -->
<link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>

<!-- Google tag (gtag.js) -->
<script>
  // Защита от падения при блокировке GA (VPN, ad blockers)
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }
  window.gtag = gtag;
  
  // Tiny helper for consistent event sending + optional console echo
  window.trackEvent = function(name, params){
    try {
      if (typeof gtag === 'function') {
        gtag('event', name, params || {});
      }
      if (window.__GA_DEBUG__) {
        console.log('[GA4]', name, params || {});
      }
    } catch (e) {
      if (window.__GA_DEBUG__) console.warn('[GA4 error]', e);
    }
  };
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-C7BHS2F2DD" onerror="console.warn('GA blocked or failed')"></script>
<script>
  // GA4 basic setup + optional DebugView toggle via ?ga_debug=1
  (function(){
    gtag('js', new Date());

    var params = new URLSearchParams(location.search);
    var isDebug = params.has('ga_debug') || params.get('debug') === '1';
    // expose for game.js optional console logging
    window.__GA_DEBUG__ = isDebug;

    gtag('config', 'G-C7BHS2F2DD', {
      debug_mode: isDebug,
      send_page_view: true,
      anonymize_ip: true
    });
    // Optional visible badge in debug mode (off by default). Enable with ?ga_badge=1
    var showBadge = params.get('ga_badge') === '1';
    if (isDebug && showBadge) {
      var badge = document.createElement('div');
      badge.textContent = 'GA4 debug ON';
      badge.style.cssText = 'position:fixed;left:8px;bottom:8px;padding:4px 8px;background:#000;color:#fff;font:12px/1.2 -apple-system,system-ui,Segoe UI,Roboto,Arial,sans-serif;border-radius:6px;opacity:.7;z-index:9999;pointer-events:none;';
      document.addEventListener('DOMContentLoaded', function(){ document.body.appendChild(badge); });
    }
  })();
</script>

<!-- Preload только первого экрана для мгновенного старта -->
<link rel="preload" as="image" href="assets/background-home.webp" type="image/webp">
<link rel="preload" as="image" href="assets/girl-default.webp" type="image/webp">
<link rel="stylesheet" href="styles.css?v=1762208001123">
<style>
  /* Loading screen */
  #loading-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #f5f5f5;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    transition: opacity 0.4s ease;
  }
  #loading-screen.hidden {
    opacity: 0;
    pointer-events: none;
  }
  .loader {
    text-align: center;
  }
  .loader-spinner {
    width: 40px;
    height: 40px;
    margin: 0 auto 16px;
    border: 3px solid #e0e0e0;
    border-top-color: #000;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  .loader-text {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
    font-size: 14px;
    color: #666;
  }
  .loader-hint {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
    font-size: 12px;
    color: #999;
    margin-top: 12px;
    max-width: 280px;
    line-height: 1.4;
  }
  body.loaded #loading-screen {
    opacity: 0;
    pointer-events: none;
  }
</style>
</head>
<body>
  <!-- Loading screen -->
  <div id="loading-screen">
    <div class="loader">
      <div class="loader-spinner"></div>
      <div class="loader-text">Загрузка...</div>
      <div class="loader-hint">Если загрузка зависла —<br> попробуйте отключить VPN</div>
    </div>
  </div>

  <div id="stage">

    <!-- Водяной знак -->
    <div class="watermark">design.kudry</div>

    <!-- Фон (2 слоя) + затемнение -->
    <div id="scene-stack">
      <img id="sceneA" class="scene-layer is-active" src="assets/background-home.webp" alt="" fetchpriority="high" decoding="async">
      <img id="sceneB" class="scene-layer"           alt="" loading="lazy" decoding="async">
      <div id="scene-dimmer"></div>
    </div>

    <!-- Персонаж (один слой, без анимации) -->
  <img id="character" src="assets/girl-default.webp" alt="character" fetchpriority="high" decoding="async" />
    
    <!-- Второй персонаж (менеджер справа) -->
  <img id="manager" src="assets/manager-default.webp" alt="manager" loading="lazy" decoding="async" />

  <!-- Стажёр (как менеджер, справа) -->
  <img id="intern" src="assets/intern-default.webp" alt="intern" loading="lazy" decoding="async" />

  <!-- Разработчик (как менеджер, справа) -->
  <img id="dev" src="assets/dev-default.webp" alt="dev" loading="lazy" decoding="async" />    <!-- Капсула 236px -->
    <div id="ui-capsule">
      <div id="badges-row">
        <div id="badge">Продуктовый дизайнер</div>
        <div id="badge-manager">Менеджер</div>
        <div id="badge-intern">Стажёрик</div>
        <div id="badge-dev">Разработчик</div>
      </div>
      <div id="dialogue" class="dialogue-gameplay"></div>
      <div id="choices-slot">
        <div id="choices" class="hidden">
          <button class="choice" onclick="workFromHome()">Работать удаленно</button>
          <button class="choice" onclick="goToOffice()">Пойти в офис</button>
        </div>
      </div>
    </div>

    <!-- Интро -->
    <div id="intro" class="dialogue-intro"></div>

    <!-- Секция финальных экранов (скрыта по умолчанию) -->
    <div id="ending-section" style="display: none;">
      <div class="ending-stack" id="ending"></div>
      <div class="ending-actions hidden">
        <button class="choice" onclick="replayGame()">Сыграть ещё раз</button>
      </div>
    </div>
  </div>

<style>
  /* Стили для финальных экранов */
  .ending-stack {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    top: 60px;
    bottom: var(--safe-bottom);
    width: var(--container-W);
    display: flex;
    flex-direction: column;
    gap: 4px;
    z-index: 6;
    pointer-events: none;
  }
  .ending-card {
    background: #fff;
    border-radius: var(--q-radius);
    border: 2px solid #000;
    padding: var(--q-pad-y) var(--q-pad-x);
    text-align: center;
    /* отображаем символы \n как перенос строки */
    white-space: pre-line;
    box-sizing: border-box;
    pointer-events: auto;
    opacity: 1;
    transition: opacity 0.4s ease;
  }
  .ending-card.hidden {
    opacity: 0;
    pointer-events: none;
  }
  .ending-header {
    text-align: center;
  }
  .ending-icon {
    display: block;
    margin: 0 auto 0;
    width: 80px;
    height: 80px;
    object-fit: contain;
  }
  .ending-title {
    margin: 0 0 0px;
    font-weight: 700;
    text-align: center;
    font-size: 18px;
    line-height: var(--lh-16);
  }
  .ending-subtitle {
    margin: 0;
    opacity: 0.9;
    text-align: center;
    font-style: italic;
    font-size: 15px;
  }
  .ending-actions {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    bottom: calc(var(--safe-bottom) + var(--ui-bottom-offset));
    width: var(--container-W);
    z-index: 7;
    opacity: 1;
    transition: opacity 0.4s ease;
  }
  .ending-actions.hidden {
    opacity: 0;
    pointer-events: none;
  }
  .ending-actions .choice {
    width: 100%;
    text-decoration: none;
    text-align: center;
    justify-content: center;
  }
  /* --- Asset protection: disable save/drag for images --- */
  #sceneA,
  #sceneB,
  #character,
  #manager,
  #intern,
  #dev,
  .ending-card img {
    -webkit-user-drag: none;
    -webkit-touch-callout: none; /* iOS long‑press menu */
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    pointer-events: none; /* not clickable, prevents long‑press save */
  }
</style>

<script>
  // Lightweight SW registration for faster repeat loads
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('sw.js').catch(() => {});
    });
  }
</script>
<script src="game.min.js?v=176220850112345" defer></script>
</body>
</html>
