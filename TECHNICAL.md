# Designer Sim — Технические требования и договорённости

См. также сценарий без технических деталей: SCENARIO.md

## Обзор
- Платформа: статический HTML/CSS/JS, одностраничное приложение (SPA).
- Архитектура: единая HTML-страница (index.html) с двумя секциями — игра и финальные экраны.
- Файлы: index.html, game.js, styles.css.
- Язык: RU.
- Управление продвижением без выборов: клик/тап по экрану, клавиши Space или Enter. Срабатывание единичное на шаг, с защитой от повторов.

## Управление и UX-паттерны
- Продвижение шагов без выбора выполняется единообразно через onNextClick: вешаем слушатели click + Space/Enter и снимаем их при первом срабатывании.
- Выборы — только кнопками на экране. Когда выборы скрыты, кнопки disabled и исключены из таб-очереди (tabIndex = -1), чтобы Space не активировал их вслепую.
- Два режима текста:
  - Интро-экраны (full-width overlay) — показываются с предварительным hideCapsule(), чтобы капсула диалога не перекрывала интро.
  - Диалог в капсуле — персонаж/НПС по необходимости, текст в диалоговой капсуле.

## Фоны и переходы
- changeScene(src) делает мягкий кроссфейд между двумя слоями (A/B) и включает полупрозрачное затемнение только фона на время кроссфейда.
- Затемнение снимается с задержкой ~2.5s для завершения перехода.
- Изображения фона и спрайтов предварительно создаются в памяти (Image + decode) для отсутствия мигания.

## Персонажи, спрайты и бейджи
- Основной персонаж (девушка): setCharacter + showCharacter()/hideCharacter() с плавным появлением/исчезанием через класс .visible (display переключается по таймеру 800ms).
- Менеджер/Стажёр/Разработчик — боковые спрайты справа, с отдельными бейджами:
  - showManager()/hideManager(), setManager(src)
  - showIntern()/hideIntern(), setIntern(src)
  - showDev()/hideDev(), setDev(src)
- Отступ стажёра: для intern-default применяется небольшой сдвиг вправо (класс .intern-offset) для выравнивания реплики «Ага, поняла».
- **Важно:** При смене спрайта персонажа, который уже виден на экране, нужно сначала дождаться загрузки нового изображения через decode()/onload, чтобы избежать мигания или показа промежуточных состояний. Функции set* используют предзагрузку через new Image() для безопасной подмены.

## Очки характера (скрытые счётчики)
- Переменные: extroversion | introversion | awareness | toxicity | empathy | indifference | perfectionism | pragmatism.
- Инкрементируются через addPoint(trait). UI-индикации нет; используются в логике итогов (экран итогов добавится позже).

## Спец-правила по сценам
- Сцена 4 (Slack):
  - Начало без смены/затемнения фона (мы уже на background-desktop из сцены 3).
  - Перед интро/репликами скрываем предыдущие капсулы/персонажей: hideCapsule(), hideCharacter(), hideDev/hideManager/hideIntern по необходимости, чтобы исключить наложения.
  - При переходах между репликами разработчика и героини явно вызываем hideDev()/hideCharacter() для избежания перекрытий.
- Сцена 5 (вечер и питч):
  - Старт без персонажа и капсулы: первые два экрана — интро-оверлеи.
  - На смене фона в вечер «Вечер. Голова тяжёлая…» — текст показывается сразу на том же тапе, что и смена фона.
  - После списка пунктов «бизнес-плана» обязательно вернуть showCapsule() перед продолжением диалога героини.

## Доступность и управление фокусом
- При скрытии выбора используем disabled и tabIndex = -1 для всех кнопок внутри блока выбора. Если фокус был внутри — снимаем.
- Для диалогов с курсивом используем innerHTML с <em> для стилистических ремарок, осторожно: вставка только собственных строк (без пользовательского ввода).

## Ассеты (имена как в коде)
- Фоны:
  - assets/background-home.png — дом (старт)
  - assets/background-homenight.png — дом вечером (финал)
  - assets/background-office.png — офис (включая вечер)
  - assets/background-coffeepoint.png — кухня/столовая
  - assets/background-desktop.png — рабочий стол
  - assets/background-meeting.png — переговорка
- Персонажи:
  - Девушка (player avatar): girl-default.png, girl-sad.png, girl-smile.png, girl-surprise.png, girl-toxic.png
  - Менеджер: manager-default.png, manager-sad.png, manager-surprise.png
  - Стажёр: intern-default.png, intern-sad.png
  - Разработчик: dev-default.png, dev-smile.png, dev-surprise.png
- Иконки архетипов (80×80px): aesthete.png, ninja.png, punk.png, skull.png, lips.png, bird.png, battery.png, ice.png
- Прочее: texture.png (зерно/шум для стилизации фона при необходимости).

## Хелперы (контракт)
- changeScene(src): мягкий кроссфейд + затемнение фона, безопасная подмена изображения по decode/onload.
- setCharacter/setManager/setIntern/setDev: мгновенная смена спрайта без мигания (с предзагрузкой).
- show*/hide*: управление видимостью через display/класс .visible; hide* снимает .visible и прячет по таймеру 800ms.
- setDialogue(text): безопасно задаёт текст диалога; для курсива дополнительно оборачиваем содержимое в <em> вручную.
- showIntro(text)/hideIntro(): управление полноэкранным интро.
- showCapsule()/hideCapsule(): переключает диалоговую капсулу.
- showChoicesHTML(html)/hideChoicesKeepSlot(): отрисовка/скрытие выбора с корректным состоянием кнопок и фокуса.
- onNextClick(fn): подписка на клик и Space/Enter с единичным срабатыванием и предотвращением повторов.

## Финальные экраны (архетипы)
- После завершения игры вызывается showArchetype(), который:
  - Рассчитывает манхэттенское расстояние от вектора игрока до 8 архетипов
  - Скрывает игровой интерфейс (intro, capsule, character)
  - Показывает секцию #ending-section (display: block)
  - Рендерит 4 карточки выбранного архетипа (header + 3 текстовых блока)
- Карточки открываются постепенно по клику/Space/Tab через функцию revealNext()
- После всех карточек появляется кнопка "Сыграть ещё раз" (replayGame → window.location.reload)
- Переход между игрой и концовками происходит без перезагрузки страницы (плавно)

## Известные нюансы/проверено
- Не оставлять видимыми персонажей при показе интро — сначала hideCapsule()/hideCharacter(), затем интро.
- В сцене 4 старт без затемнения; в сцене 5 первые два экрана — только интро.
- Переходы между репликами разных персонажей сопровождаются скрытием предыдущего спрайта, чтобы исключить наложения.

## Ссылки
- Нарративный сценарий: SCENARIO.md
